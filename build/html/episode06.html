<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>6. Enabling Storage &mdash; Firefox OS App Development Tutorial 2nd Edition documentation</title>
    
    <link rel="stylesheet" href="_static/style.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2nd Edition',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="copyright" title="Copyright" href="copyright.html" />
    <link rel="top" title="Firefox OS App Development Tutorial 2nd Edition documentation" href="index.html" />
    <link rel="next" title="7. Storage using IndexedDB" href="episode07.html" />
    <link rel="prev" title="5. Location, Location, Location" href="episode05.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="episode07.html" title="7. Storage using IndexedDB"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="episode05.html" title="5. Location, Location, Location"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Firefox OS App Development Tutorial 2nd Edition documentation</a> &raquo;</li> 
      </ul>
    </div>

    <div class="document">
      <div class="documentwrapper">
          <div class="body">
            
  <div class="section" id="enabling-storage">
<span id="storage"></span><h1>6. Enabling Storage<a class="headerlink" href="#enabling-storage" title="Permalink to this headline">¶</a></h1>
<p>Welcome to Episode 6 of the Firefox OS App Development Tutorial. This episode
will take you through the steps for writing Firefox OS Apps that add
persistence capability to your application. What this means is that you can use
a local database of sorts to save your data and the data will be available not
just across the application but also across application restarts.</p>
<div class="section" id="prerequisites">
<h2>6.1. Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>You have setup your machine with the Firefox OS simulator.  If not you can
check out <a class="reference internal" href="episode01.html#dev-setup"><em>Overview and Development Setup</em></a>, which takes you through the entire setup.</li>
<li>You have installed the <tt class="docutils literal"><span class="pre">zipcodeapp</span></tt> that we covered in <a class="reference internal" href="episode02.html#hello-world"><em>Hello World</em></a>.
This tutorial uses that as an example, but if you have any other application
installed in the Firefox WebIDE, then you should be able to follow along.</li>
</ul>
</div>
<div class="section" id="what-this-episode-covers">
<h2>6.2. What this Episode covers<a class="headerlink" href="#what-this-episode-covers" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>What is the HTML5 LocalStorage API.</li>
<li>Sample Firefox OS Application that covers using HTML5 LocalStorage API.</li>
</ul>
</div>
<div class="section" id="episode-6-in-action">
<h2>6.3. Episode 6 in Action<a class="headerlink" href="#episode-6-in-action" title="Permalink to this headline">¶</a></h2>
<p>Let us check out the application in action first. This will help you understand
what we shall be achieving by the end of this episode.</p>
<p>What we shall write is a mobile application that will allow us to save some
quick notes. Each note will have a title and some details. These notes will be
saved in the Local Storage of the device and then we can view all our notes
too.</p>
<p>All right then, the first screen of the mobile app is shown below:</p>
<a class="reference internal image-reference" href="_images/save_notes1.png"><img alt="SaveNotes app on launch" src="_images/save_notes1.png" style="height: 350px;" /></a>
<p>When we click on the <tt class="docutils literal"><span class="pre">Add</span> <span class="pre">a</span> <span class="pre">Note</span></tt> button, we get a screen as shown below
where we can enter the title and details for the new note. Once we are done, we
can save the note by clicking on the <tt class="docutils literal"><span class="pre">Save</span> <span class="pre">Note</span></tt> button.</p>
<a class="reference internal image-reference" href="_images/save_notes2.png"><img alt="SaveNotes app with first note being edited" src="_images/save_notes2.png" style="height: 350px;" /></a>
<p>If the note is successfully saved, it will display a message as shown below:</p>
<a class="reference internal image-reference" href="_images/save_notes3.png"><img alt="SaveNotes app with first note saved" src="_images/save_notes3.png" style="height: 350px;" /></a>
<p>To view all the notes, you need to click on the <tt class="docutils literal"><span class="pre">View</span> <span class="pre">Notes</span></tt> button from the
main screen. This will retrieve all the notes from the Local Storage and
display them to you in a collapsible list form.</p>
<a class="reference internal image-reference" href="_images/save_notes4.png"><img alt="SaveNotes app with list of notes" src="_images/save_notes4.png" style="height: 350px;" /></a>
<p>You can click on any of the <tt class="docutils literal"><span class="pre">+</span></tt> signs and it will expand to show you the note
details as shown below:</p>
<a class="reference internal image-reference" href="_images/save_notes5.png"><img alt="SaveNotes app with list with expanded 2nd note" src="_images/save_notes5.png" style="height: 350px;" /></a>
<p>If you wish to delete all the notes, there is also a <tt class="docutils literal"><span class="pre">Clear</span></tt> button. This
will delete permanently all the notes from the Local Storage.</p>
<p>Let’s get going with the code. Note that the example screenshots are from the
Firefox OS simulator running locally. So you can use your Firefox OS Simulator
to run all the examples.</p>
</div>
<div class="section" id="download-full-source-code-episode-6">
<h2>6.4. Download Full Source Code – Episode 6<a class="headerlink" href="#download-full-source-code-episode-6" title="Permalink to this headline">¶</a></h2>
<p>I suggest that you begin with a full download of the project source code.
Since the project depends on libraries like jQuery and jQuery Mobile, it will
save you the hassle of downloading the dependent libraries.</p>
<p>Go ahead &amp; download the code from: <a class="reference external" href="https://github.com/anicholakos/SaveNotes">https://github.com/anicholakos/SaveNotes</a></p>
<p>Extract all the code in some directory. You should see a directory structure
inside of <tt class="docutils literal"><span class="pre">SaveNotes</span></tt> that looks something like this:</p>
<a class="reference internal image-reference" href="_images/save_notes_files.png"><img alt="SaveNotes app directory contents" src="_images/save_notes_files.png" style="height: 350px;" /></a>
</div>
<div class="section" id="html5-storage-apis">
<h2>6.5. HTML5 Storage APIs<a class="headerlink" href="#html5-storage-apis" title="Permalink to this headline">¶</a></h2>
<p>The HTML5 Storage API is a JavaScript API that will allow your application to
store data and retain that data even across browser restarts.</p>
<p>As a first step to make web applications work offline, we need a storage API
that allows the application to store application specific data and use it as
needed. Here are some examples of how you could use storage:</p>
<ul class="simple">
<li>Games: You need to store the current moves in an application, so that if the
user were to come back later to the application, it would replay back the
moves. This also allows applications to store a user&#8217;s highscores in a game.</li>
<li>Business Apps: How about saving information locally? For example, taking offline orders, writing notes locally, and looking them up later.</li>
</ul>
<p>You will easily be able to think of more use cases.</p>
<p>The Storage API also known as the Local Storage API provides a key based
storage with a simple API to go along with it. The amount of storage size
allocated per domain is anywhere from 5MB-10MB, which should be sufficient for
most applications. There is also another API available for storage (IndexedDB),
which provides a more sophisticated database like structure a la SQL, but we
shall keep the discussion limited now to simple storage support in the form of
key-based values.</p>
<p>Few things to do about the Storage API:</p>
<ul>
<li><p class="first">The Local Storage Object that is provided to you is available under
<tt class="docutils literal"><span class="pre">window.localStorage</span></tt>, but for all purposes, you can use as
<tt class="docutils literal"><span class="pre">localStorage</span></tt>. All the methods for saving, removing, etc will be invoked
in a format that looks like <tt class="docutils literal"><span class="pre">localStorage.&lt;some-method&gt;</span></tt>.</p>
</li>
<li><p class="first">There are just 6 methods that you need to be familiar with to understand the
localStorage API. If you have worked with maps or key-value data structures
before in any language, it should be familiar.</p>
</li>
<li><dl class="first docutils">
<dt>The methods are:</dt>
<dd><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">getItem(&lt;key&gt;)</span></tt>: Returns back the value for the key.</li>
<li><tt class="docutils literal"><span class="pre">setItem(&lt;key&gt;,&lt;value&gt;)</span></tt>: Sets a value (Creates or overwrites) for a
key.</li>
<li><tt class="docutils literal"><span class="pre">removeItem(&lt;key&gt;)</span></tt>: Deletes the entry for that particular key.</li>
<li><tt class="docutils literal"><span class="pre">clear()</span></tt>: Removes all the entries in the Local Storage.</li>
<li><tt class="docutils literal"><span class="pre">length</span></tt>: Returns a count of the number of keys in the local storage.</li>
<li><tt class="docutils literal"><span class="pre">key(&lt;index&gt;)</span></tt>: returns the value for a key as per the index. The
index ranges from 0 to (length-1).</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="savenotes-application">
<h2>6.6. SaveNotes Application<a class="headerlink" href="#savenotes-application" title="Permalink to this headline">¶</a></h2>
<p>OK. Let&#8217;s get going with understand the code and how the Local Storage API has
been used to persist (save) notes in our application.</p>
</div>
<div class="section" id="savenotes-application-manifest-webapp">
<h2>6.7. SaveNotes Application - <tt class="docutils literal"><span class="pre">manifest.webapp</span></tt><a class="headerlink" href="#savenotes-application-manifest-webapp" title="Permalink to this headline">¶</a></h2>
<p>The first thing we should discuss is the manifest file. This should be familiar
now and it has the standard attributes like name and version. There is
nothing special happening here.</p>
<div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;version&quot;</span><span class="o">:</span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
    <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Notes&quot;</span><span class="p">,</span>
    <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;Uses the HTML5 Storage API to demonstrate how to save data in your Firefox OS Apps.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;launch_path&quot;</span><span class="o">:</span> <span class="s2">&quot;/index.html&quot;</span><span class="p">,</span>
    <span class="s2">&quot;icons&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;128&quot;</span><span class="o">:</span> <span class="s2">&quot;/images/notes_128.png&quot;</span><span class="p">,</span>
        <span class="s2">&quot;512&quot;</span><span class="o">:</span> <span class="s2">&quot;/images/notes_512.png&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;developer&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Romin Irani&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;http://www.rominirani.com&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;default_locale&quot;</span><span class="o">:</span> <span class="s2">&quot;en&quot;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="savenotes-application-index-html">
<h2>6.8. SaveNotes Application - <tt class="docutils literal"><span class="pre">index.html</span></tt><a class="headerlink" href="#savenotes-application-index-html" title="Permalink to this headline">¶</a></h2>
<p>Next up is the <tt class="docutils literal"><span class="pre">index.html</span></tt> page and it is a simple jQuery Mobile page.</p>
<div class="highlight-html"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>

<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content=</span><span class="s">&quot;width=device-width, initial-scale=1&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;title&gt;</span>Notes<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;jquery.mobile-1.4.5.min.css&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;jquery-2.1.4.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;jquery.mobile-1.4.5.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;app.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>

<span class="nt">&lt;body&gt;</span>

<span class="c">&lt;!-- Start of first page: #home --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">data-role=</span><span class="s">&quot;page&quot;</span> <span class="na">id=</span><span class="s">&quot;home&quot;</span><span class="nt">&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">data-role=</span><span class="s">&quot;header&quot;</span> <span class="na">data-position=</span><span class="s">&quot;fixed&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h3&gt;</span>Notes<span class="nt">&lt;/h3&gt;</span>
  <span class="nt">&lt;/div&gt;</span><span class="c">&lt;!-- /header --&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">data-role=</span><span class="s">&quot;content&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span> <span class="na">id=</span><span class="s">&quot;btnAddNote&quot;</span> <span class="na">data-role=</span><span class="s">&quot;button&quot;</span><span class="nt">&gt;</span>Add a Note<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span> <span class="na">id=</span><span class="s">&quot;btnViewNotes&quot;</span> <span class="na">data-role=</span><span class="s">&quot;button&quot;</span><span class="nt">&gt;</span>View Notes<span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;/div&gt;</span><span class="c">&lt;!-- /content --&gt;</span>

<span class="nt">&lt;/div&gt;</span><span class="c">&lt;!-- /page home --&gt;</span>

<span class="c">&lt;!-- Start of the second page : #add-notes --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">data-role=</span><span class="s">&quot;page&quot;</span> <span class="na">id=</span><span class="s">&quot;add-notes&quot;</span><span class="nt">&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">data-role=</span><span class="s">&quot;header&quot;</span> <span class="na">data-add-back-btn=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Add a Note<span class="nt">&lt;/h1&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">data-role=</span><span class="s">&quot;content&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">id=</span><span class="s">&quot;noteTitle&quot;</span> <span class="na">value=</span><span class="s">&quot;&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;Title&quot;</span> <span class="na">autofocus</span><span class="nt">&gt;</span>
    <span class="nt">&lt;textarea</span> <span class="na">placeholder=</span><span class="s">&quot;Details&quot;</span> <span class="na">name=</span><span class="s">&quot;noteDetails&quot;</span> <span class="na">id=</span><span class="s">&quot;noteDetails&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/textarea&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span> <span class="na">id=</span><span class="s">&quot;btnSaveNote&quot;</span> <span class="na">data-role=</span><span class="s">&quot;button&quot;</span><span class="nt">&gt;</span>Save Note<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span> <span class="na">id=</span><span class="s">&quot;btnClearNotes&quot;</span> <span class="na">data-role=</span><span class="s">&quot;button&quot;</span><span class="nt">&gt;</span>Clear<span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;/div&gt;</span><span class="c">&lt;!-- /page add-notes --&gt;</span>

<span class="c">&lt;!-- Start of the third page : #view-notes --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">data-role=</span><span class="s">&quot;page&quot;</span> <span class="na">id=</span><span class="s">&quot;view-notes&quot;</span><span class="nt">&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">data-role=</span><span class="s">header</span> <span class="na">data-add-back-btn=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1&gt;</span>List of Notes<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span> <span class="na">data-role=</span><span class="s">&quot;button&quot;</span> <span class="na">class=</span><span class="s">&quot;ui-btn-right&quot;</span>
    <span class="na">id=</span><span class="s">&quot;clearAllNotesBtn&quot;</span><span class="nt">&gt;</span>Clear<span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;note-list&quot;</span> <span class="na">data-role=</span><span class="s">&quot;content&quot;</span><span class="nt">&gt;</span>
  
  <span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;/div&gt;</span><span class="c">&lt;!-- /page view-notes --&gt;</span>

<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</td></tr></table></div>
<p>Let us discuss the <tt class="docutils literal"><span class="pre">index.html</span></tt> page in detail now:</p>
<ul>
<li><p class="first">We have included the script in the <tt class="docutils literal"><span class="pre">app.js</span> <span class="pre">file</span></tt> on <strong>Line 11</strong>.</p>
</li>
<li><dl class="first docutils">
<dt>There are 3 pages in the mobile application:</dt>
<dd><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">home</span></tt> (<strong>Lines 17-28</strong>).</li>
<li><tt class="docutils literal"><span class="pre">add-notes</span></tt> (<strong>Lines 31-44</strong>).</li>
<li><tt class="docutils literal"><span class="pre">view-notes</span></tt> (<strong>Lines 47-59</strong>).</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">#home</span></tt> page has two buttons for <tt class="docutils literal"><span class="pre">Add</span> <span class="pre">a</span> <span class="pre">Note</span></tt> and <tt class="docutils literal"><span class="pre">View</span> <span class="pre">Notes</span></tt>.</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">#add-notes</span></tt> page has a form for entering the title (<tt class="docutils literal"><span class="pre">#noteTile</span></tt>),
details (<tt class="docutils literal"><span class="pre">#noteDetails</span></tt>) and two buttons for saving the note
(<tt class="docutils literal"><span class="pre">#btnSaveNote</span></tt>) and clearing the fields (<tt class="docutils literal"><span class="pre">#btnClearNotes</span></tt>).</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">#view-notes</span></tt> page has a button in the header to clear all notes
(<tt class="docutils literal"><span class="pre">#clearAllNotesBtn</span></tt>) and it has a div area (<tt class="docutils literal"><span class="pre">#note-list</span></tt>) to display all
current notes, once we get them from the Local Storage.</p>
</li>
</ul>
</div>
<div class="section" id="savenotes-application-app-js">
<h2>6.9. SaveNotes Application - <tt class="docutils literal"><span class="pre">app.js</span></tt><a class="headerlink" href="#savenotes-application-app-js" title="Permalink to this headline">¶</a></h2>
<div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53</pre></div></td><td class="code"><div class="highlight"><pre><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#btnAddNote&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">//Change to the add-notes</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">mobile</span><span class="p">.</span><span class="nx">changePage</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#add-notes&quot;</span><span class="p">));</span>
    <span class="p">});</span>

    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#btnViewNotes&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">//Change to the add-notes</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">mobile</span><span class="p">.</span><span class="nx">changePage</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#view-notes&quot;</span><span class="p">));</span>
        <span class="c1">//Empty the list first</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#note-list&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
        <span class="c1">//Read the notes</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;=</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>  
            <span class="nx">key</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">key</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>  
            <span class="nx">val</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">noteElement</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;div data-role=&#39;collapsible&#39; data-mini=&#39;true&#39;/&gt;&quot;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">h3NoteTitle</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;h3/&gt;&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">pNoteDetails</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;p/&gt;&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
            <span class="nx">noteElement</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">h3NoteTitle</span><span class="p">);</span>
            <span class="nx">noteElement</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">pNoteDetails</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#note-list&quot;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">noteElement</span><span class="p">);</span>
        <span class="p">}</span>  
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;div[data-role=collapsible]&#39;</span><span class="p">).</span><span class="nx">collapsible</span><span class="p">({</span><span class="nx">refresh</span><span class="o">:</span><span class="kc">true</span><span class="p">});</span>
    <span class="p">});</span>
		
    <span class="c1">//Click Handlers for Add Notes page</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#btnSaveNote&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">noteTitle</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#noteTitle&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
        <span class="nx">noteDetails</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#noteDetails&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
        <span class="c1">//alert(noteTitle + &quot;,&quot; + noteDetails);</span>
        <span class="c1">//Save it in local storage and stay there</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">noteTitle</span><span class="p">,</span> <span class="nx">noteDetails</span><span class="p">);</span>
            <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Your note has been saved&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="c1">//Clear input areas for new note</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#noteTitle&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#noteDetails&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#btnClearNotes&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#noteTitle&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#noteDetails&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#noteTitle&quot;</span><span class="p">).</span><span class="nx">focus</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="c1">//Click Handlers for View Notes page</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#clearAllNotesBtn&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">localStorage</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#note-list&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;All notes have been cleared&quot;</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</td></tr></table></div>
<p>Let us discuss the source code in detail now since it contains the HTML5
LocalStorage JavaScript API:</p>
<ul>
<li><p class="first"><strong>Lines 2-5</strong> indicate that when we click on the <tt class="docutils literal"><span class="pre">Add</span> <span class="pre">a</span> <span class="pre">Note</span></tt> button in the
<tt class="docutils literal"><span class="pre">home</span></tt> page, it will navigate to the <tt class="docutils literal"><span class="pre">add-notes</span></tt> page. This is
jQuery Mobile stuff.</p>
</li>
<li><p class="first">Let us first focus on adding or saving the note, <strong>lines 27-39</strong>. Here you
will notice that we first extract out the values that the user has entered
for <tt class="docutils literal"><span class="pre">title</span></tt> and <tt class="docutils literal"><span class="pre">detail</span></tt>. Then on <strong>line 32</strong> we check if the
<tt class="docutils literal"><span class="pre">localStorage</span></tt> object is available i.e. if support for it is there. If yes,
we simply invoke the <tt class="docutils literal"><span class="pre">localStorage.setItem(&lt;key&gt;,</span> <span class="pre">&lt;value&gt;)</span></tt> method. This
will save the key-value in the local storage. Note that we are using the
title of the note as the key. So if you enter the same title again but with
different details, it will overwrite the value because the key is the same.
So keep in mind, that the <tt class="docutils literal"><span class="pre">setItem</span></tt> method functions as both an <tt class="docutils literal"><span class="pre">Add</span></tt> and
an <tt class="docutils literal"><span class="pre">Update</span></tt>.  That is all there is to save the item. Note that we have
saved a simple string value here, but you could put entire JSON Objects over
here (Object, Array) and read back the values.</p>
</li>
<li><p class="first">Now let us focus on <strong>lines 7-24</strong>.  <strong>Lines 7-9</strong> indicate that when we
press the <tt class="docutils literal"><span class="pre">View</span> <span class="pre">Notes</span></tt> button on the <tt class="docutils literal"><span class="pre">home</span></tt> page, it will navigate to the
<tt class="docutils literal"><span class="pre">view-notes</span></tt> page.</p>
</li>
<li><p class="first">We clear the content i.e. any existing items that were present on the page
by clearing the html content for <tt class="docutils literal"><span class="pre">#note-list</span></tt> on <strong>line 11</strong>.</p>
</li>
<li><p class="first">Then we iterate through the <tt class="docutils literal"><span class="pre">localStorage</span></tt> keys one by one, retrieve the
values and form the jQuery Mobile collapsible div for each note entry. Note
that this loop (<strong>lines 13-22</strong>) makes use of 3 additional methods of
localStorage:</p>
<blockquote>
<div><ul class="simple">
<li>We first use the <tt class="docutils literal"><span class="pre">localStorage.length</span></tt> method to get the total number
of items that are present.</li>
<li>Next we get the key for each item via the <tt class="docutils literal"><span class="pre">localStorage.key(index)</span></tt>
method.</li>
<li>Finally, we use the <tt class="docutils literal"><span class="pre">localStorage.getItem(&lt;key&gt;)</span></tt> method to retrieve
the details for the note.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">For each note, we are simply creating a collapsible div for jQuery
Mobile UI and appending it to the <tt class="docutils literal"><span class="pre">#note-list</span></tt> element.</p>
</li>
</ul>
</div>
<div class="section" id="local-installation-and-testing">
<h2>6.10. Local Installation and Testing<a class="headerlink" href="#local-installation-and-testing" title="Permalink to this headline">¶</a></h2>
<p>This completes our discussion of writing Firefox OS applications that utilize
the HTML5 LocalStorage API. Now comes the part of seeing it actually work. All
we need to test out this application is:</p>
<ol class="arabic simple">
<li>You should have installed the Firefox OS Simulator into the WebIDE.</li>
<li>You should have downloaded/written the application as described above. We
will assume that the <tt class="docutils literal"><span class="pre">index.html</span></tt> and <tt class="docutils literal"><span class="pre">manifest.webapp</span></tt> files are
present in a directory named <tt class="docutils literal"><span class="pre">SaveNotes</span></tt>. You should navigate to your own
directory structure when called to later.</li>
</ol>
</div>
<div class="section" id="debugging-local-storage">
<h2>6.11. Debugging Local Storage<a class="headerlink" href="#debugging-local-storage" title="Permalink to this headline">¶</a></h2>
<p>If you recollect Episode 3 : Working with the OS Simulator, we had covered how to start the WebIDE and run an application
in the FirefoxOS simulator and debug the execution.</p>
<p>You can debug the current state of the localStorage object in the same manner.
To try that out, go to the WebIDE in your Firefox browser and start the
SaveNotes application. Once connected to the running instance of the SaveNotes application,
click the wrench and the console window will be visible.</p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/debugging11.png"><img alt="Developer console" src="_images/debugging11.png" style="height: 150px;" /></a>
</div></blockquote>
<p>In the developer console, go ahead and type localStorage as shown above and hit Enter.
This will show the current state of the localStorage object as shown below. For example, I had a few notes saved
and hence you see that list. I suggest you give it a try by inspecting localStorage without any items, then
add a few items and then inspect the value again. You will be able to see the list of items that you have added.</p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/debugging2.png"><img alt="Developer console object" src="_images/debugging2.png" style="height: 150px;" /></a>
</div></blockquote>
<p>You can even try out the different methods of the localStorage API. For example, in the screenshot below,
I have tried out localStorage.length. That returns me a value of 2, since I have 2 notes saved. Similarly,
I have also tried out localStorage.key(0) that returns me the value of the key at index 0.</p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/debugging3.png"><img alt="Developer Console localStorage API" src="_images/debugging3.png" style="height: 150px;" /></a>
</div></blockquote>
</div>
<div class="section" id="next-steps">
<h2>6.12. Next Steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">¶</a></h2>
<p>I encourage you to enhance the current application by giving the ability to delete individual notes.
You could even opt for a more array-like representation of the data that you put in <tt class="docutils literal"><span class="pre">localStorage</span></tt>.
Consider adding a search feature on the View Notes screen. There are lots of opportunities for improvement!</p>
<p>If you would like to learn more about local storage, I strongly suggest for you for try out the following tutorial: <a class="reference external" href="http://diveintohtml5.info/storage.html">Dive Into HTML5: Storage</a>.</p>
<p>Alternatively, you can also look at a couple of my blog posts: <a class="reference external" href="http://rominirani.com/html5-recipes-storage-101/">Storage 101</a> and <a class="reference external" href="http://rominirani.com/html5-recipes-more-on-storage/">More on Local Storage</a>.</p>
</div>
<div class="section" id="coming-up-next">
<h2>6.13. Coming Up Next<a class="headerlink" href="#coming-up-next" title="Permalink to this headline">¶</a></h2>
<p>The next episodes will either cover another HTML5 API for persistence called IndexedDB.
This is more powerful compared to <tt class="docutils literal"><span class="pre">localStorage</span></tt> and gives you an SQL-like ability to work with your databases.</p>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="episode07.html" title="7. Storage using IndexedDB"
             >next</a> |</li>
        <li class="right" >
          <a href="episode05.html" title="5. Location, Location, Location"
             >previous</a> |</li>
        <li><a href="index.html">Firefox OS App Development Tutorial 2nd Edition documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; <a href="copyright.html">Copyright</a> 2015, Romin Irani.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>